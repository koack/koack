{"version":3,"file":"index-node6-dev.cjs.js","sources":["../src/index.ts"],"sourcesContent":["import route from 'koa-route';\nimport parse from 'co-body/lib/form';\nimport { INTERACTIVE_MESSAGE_RESPONSE } from 'koack-core';\nimport Pool from 'koack-pool';\nimport { Context } from 'koa';\n\nexport interface Options {\n  pool: Pool,\n  token: string,\n  url?: string,\n}\n\nexport default ({ pool, token, url = '/interactive-message' }: Options) => (\n  route.post(url, async (ctx: Context) => {\n    let { payload } = await parse(ctx);\n    if (!payload) throw new Error('Invalid payload');\n    payload = JSON.parse(payload);\n    if (payload.token !== token) throw new Error('Invalid token');\n\n    const {\n      actions,\n      callback_id: callbackId,\n      team,\n      channel,\n      user,\n      action_ts: actionTs,\n      message_ts: messageTs,\n      attachment_id: attachmentId,\n      original_message: originalMessage,\n      response_url: responseUrl,\n    } = payload;\n\n    const data = {\n      actions,\n      callbackId,\n      team,\n      channel,\n      user,\n      actionTs,\n      messageTs,\n      attachmentId,\n      originalMessage,\n      responseUrl,\n    };\n    pool.sendBotMessage(team.id, { type: 'event', name: INTERACTIVE_MESSAGE_RESPONSE.toString(), data });\n  })\n);\n"],"names":["route","post","url","ctx","parse","payload","Error","JSON","token","callbackId","actionTs","messageTs","attachmentId","originalMessage","responseUrl","sendBotMessage","team","id","INTERACTIVE_MESSAGE_RESPONSE","toString"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA,aAAe,CAAC;MAAA;OAAA;QAAqB;CAAtB,KACbA,MAAMC,IAAN,CAAWC,GAAX;;AAAA;+BAAgB,WAAOC,GAAP,EAAwB;QAClC;;cAAoBC,MAAMD,GAAN,CAAxB;QACI,CAACE,OAAL,EAAc,MAAM,IAAIC,KAAJ,CAAU,iBAAV,CAAN;cACJC,KAAKH,KAAL,CAAWC,OAAX,CAAV;QACIA,QAAQG,KAAR,KAAkBA,KAAtB,EAA6B,MAAM,IAAIF,KAAJ,CAAU,eAAV,CAAN;UAEvB;aAAA;mBAESG,UAFT;UAAA;aAAA;UAAA;iBAMOC,QANP;kBAOQC,SAPR;qBAQWC,YARX;wBAScC,eATd;oBAUUC;QACZT,OAXJ;SAyBKU,cAAL,CAAoBC,KAAKC,EAAzB,EAA6B;YAAQ,OAAR;YAAuBC,uCAA6BC,QAA7B,EAAvB;YAZhB;eAAA;kBAAA;YAAA;eAAA;YAAA;gBAAA;iBAAA;oBAAA;uBAAA;;;KAYb;GA/BF;;;;;IADF;;;;"}