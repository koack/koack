{"version":3,"file":"index-node10-dev.cjs.js","sources":["../src/index.ts"],"sourcesContent":["import route from 'koa-route';\nimport parse from 'co-body/lib/form';\nimport { INTERACTIVE_MESSAGE_RESPONSE } from 'koack-core';\nimport Pool from 'koack-pool';\nimport { Context } from 'koa';\n\nexport interface Options {\n  pool: Pool,\n  token: string,\n  url?: string,\n}\n\nexport default ({ pool, token, url = '/interactive-message' }: Options) => (\n  route.post(url, async (ctx: Context) => {\n    let { payload } = await parse(ctx);\n    if (!payload) throw new Error('Invalid payload');\n    payload = JSON.parse(payload);\n    if (payload.token !== token) throw new Error('Invalid token');\n\n    const {\n      actions,\n      callback_id: callbackId,\n      team,\n      channel,\n      user,\n      action_ts: actionTs,\n      message_ts: messageTs,\n      attachment_id: attachmentId,\n      original_message: originalMessage,\n      response_url: responseUrl,\n    } = payload;\n\n    const data = {\n      actions,\n      callbackId,\n      team,\n      channel,\n      user,\n      actionTs,\n      messageTs,\n      attachmentId,\n      originalMessage,\n      responseUrl,\n    };\n    pool.sendBotMessage(team.id, { type: 'event', name: INTERACTIVE_MESSAGE_RESPONSE.toString(), data });\n  })\n);\n"],"names":["route","post","url","ctx","parse","payload","Error","JSON","token","callbackId","actionTs","messageTs","attachmentId","originalMessage","responseUrl","sendBotMessage","team","id","INTERACTIVE_MESSAGE_RESPONSE","toString"],"mappings":";;;;;;;;;;AAYA,aAAe,CAAC;MAAA;OAAA;QAAqB;CAAtB,KACbA,MAAMC,IAAN,CAAWC,GAAX,EAAgB,MAAOC,GAAP,IAAwB;MAClC;;MAAc,MAAMC,MAAMD,GAAN,CAAxB;MACI,CAACE,OAAL,EAAc,MAAM,IAAIC,KAAJ,CAAU,iBAAV,CAAN;YACJC,KAAKH,KAAL,CAAWC,OAAX,CAAV;MACIA,QAAQG,KAAR,KAAkBA,KAAtB,EAA6B,MAAM,IAAIF,KAAJ,CAAU,eAAV,CAAN;QAEvB;WAAA;iBAESG,UAFT;QAAA;WAAA;QAAA;eAMOC,QANP;gBAOQC,SAPR;mBAQWC,YARX;sBAScC,eATd;kBAUUC;MACZT,OAXJ;OAyBKU,cAAL,CAAoBC,KAAKC,EAAzB,EAA6B;UAAQ,OAAR;UAAuBC,uCAA6BC,QAA7B,EAAvB;UAZhB;aAAA;gBAAA;UAAA;aAAA;UAAA;cAAA;eAAA;kBAAA;qBAAA;;;GAYb;CA/BF,CADF;;;;"}