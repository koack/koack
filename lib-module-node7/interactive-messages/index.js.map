{"version":3,"sources":["../../src/interactive-messages/index.js"],"names":["route","parse","INTERACTIVE_MESSAGE_RESPONSE","pool","token","url","post","ctx","payload","Error","JSON","actions","callback_id","callbackId","team","channel","user","action_ts","actionTs","message_ts","messageTs","attachment_id","attachmentId","original_message","originalMessage","response_url","responseUrl","sendBotMessage","id","type","name","toString","data"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,WAAlB;AACA,OAAOC,KAAP,MAAkB,kBAAlB;AACA,SAASC,4BAAT,QAA6C,KAA7C;;;AASA,gBAAe,CAAC,EAAEC,IAAF,EAAQC,KAAR,EAAeC,MAAM,sBAArB,EAAD,KACbL,MAAMM,IAAN,CAAWD,GAAX,EAAgB,MAAOE,GAAP,IAAe;AAC7B,MAAI,EAAEC,OAAF,KAAc,MAAMP,MAAMM,GAAN,CAAxB;AACA,MAAI,CAACC,OAAL,EAAc,MAAM,IAAIC,KAAJ,CAAU,iBAAV,CAAN;AACdD,YAAUE,KAAKT,KAAL,CAAWO,OAAX,CAAV;AACA,MAAIA,QAAQJ,KAAR,KAAkBA,KAAtB,EAA6B,MAAM,IAAIK,KAAJ,CAAU,eAAV,CAAN;;AAE7B,QAAM;AACJE,WADI;AAEJC,iBAAaC,UAFT;AAGJC,QAHI;AAIJC,WAJI;AAKJC,QALI;AAMJC,eAAWC,QANP;AAOJC,gBAAYC,SAPR;AAQJC,mBAAeC,YARX;AASJC,sBAAkBC,eATd;AAUJC,kBAAcC;AAVV,MAWFlB,OAXJ;;AAyBAL,OAAKwB,cAAL,CAAoBb,KAAKc,EAAzB,EAA6B,EAAEC,MAAM,OAAR,EAAiBC,MAAM5B,6BAA6B6B,QAA7B,EAAvB,EAAgEC,MAZhF;AACXrB,aADW;AAEXE,gBAFW;AAGXC,UAHW;AAIXC,aAJW;AAKXC,UALW;AAMXE,cANW;AAOXE,eAPW;AAQXE,kBARW;AASXE,qBATW;AAUXE;AAVW,KAYgB,EAA7B;AACD,CAhCD,CADF","file":"index.js","sourcesContent":["import route from 'koa-route';\nimport parse from 'co-body/lib/form';\nimport { INTERACTIVE_MESSAGE_RESPONSE } from '../';\nimport type Pool from '../pool';\n\ntype OptionsType = {\n  pool: Pool,\n  token: string,\n  url: ?string,\n}\n\nexport default ({ pool, token, url = '/interactive-message' }: OptionsType) => (\n  route.post(url, async (ctx) => {\n    let { payload } = await parse(ctx);\n    if (!payload) throw new Error('Invalid payload');\n    payload = JSON.parse(payload);\n    if (payload.token !== token) throw new Error('Invalid token');\n\n    const {\n      actions,\n      callback_id: callbackId,\n      team,\n      channel,\n      user,\n      action_ts: actionTs,\n      message_ts: messageTs,\n      attachment_id: attachmentId,\n      original_message: originalMessage,\n      response_url: responseUrl,\n    } = payload;\n\n    const data = {\n      actions,\n      callbackId,\n      team,\n      channel,\n      user,\n      actionTs,\n      messageTs,\n      attachmentId,\n      originalMessage,\n      responseUrl,\n    };\n    pool.sendBotMessage(team.id, { type: 'event', name: INTERACTIVE_MESSAGE_RESPONSE.toString(), data });\n  })\n);\n"]}