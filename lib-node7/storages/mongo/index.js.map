{"version":3,"sources":["../../../src/storages/mongo/index.js"],"names":["mongoUrl","connection","connect","teams","collection","forEach","callback","find","installedTeam","installInfo","team","findOne","_id","id","insertOne"],"mappings":";;;;;;AAEA;;AAEA;;AAHA;kBAKe,MAAOA,QAAP,IAAkD;AAC/D,QAAMC,aAAa,MAAM,qBAAYC,OAAZ,CAAoBF,QAApB,CAAzB;AACA,QAAMG,QAAQF,WAAWG,UAAX,CAAsB,OAAtB,CAAd;;AAEA,SAAO;AACLC,aAAUC,QAAD,IAAcH,MAAMI,IAAN,KAAeF,OAAf,CAAuBC,QAAvB,CADlB;;AAGLE,mBAAe,MAAOC,WAAP,IAAwC;AACrD,UAAIC,OAAkB,MAAMP,MAAMQ,OAAN,CAAc,EAAEC,KAAKH,YAAYC,IAAZ,CAAiBG,EAAxB,EAAd,CAA5B;;AAEA,UAAI,CAACH,IAAL,EAAW;AACTA;AACEE,eAAKH,YAAYC,IAAZ,CAAiBG;AADxB,WAEK,uBAAWJ,WAAX,CAFL;;AAKA,cAAMN,MAAMW,SAAN,CAAgBJ,IAAhB,CAAN;AACD,OAPD,MAOO;AACLA,eAAO,uBAAWA,IAAX,EAAiBD,WAAjB,CAAP;AACD;;AAED,aAAOC,IAAP;AACD;AAlBI,GAAP;AAoBD,C","file":"index.js","sourcesContent":["/* @flow */\n// eslint-disable-next-line import/no-unresolved, import/extensions\nimport { MongoClient } from 'mongodb';\nimport type { InstallInfoType, StorageType, TeamType } from '../../types';\nimport { createTeam, updateTeam } from '../utils';\n\nexport default async (mongoUrl: string): Promise<StorageType> => {\n  const connection = await MongoClient.connect(mongoUrl);\n  const teams = connection.collection('teams');\n\n  return {\n    forEach: (callback) => teams.find({}).forEach(callback),\n\n    installedTeam: async (installInfo: InstallInfoType) => {\n      let team: ?TeamType = await teams.findOne({ _id: installInfo.team.id });\n\n      if (!team) {\n        team = {\n          _id: installInfo.team.id,\n          ...createTeam(installInfo),\n        };\n\n        await teams.insertOne(team);\n      } else {\n        team = updateTeam(team, installInfo);\n      }\n\n      return team;\n    },\n  };\n};\n"]}