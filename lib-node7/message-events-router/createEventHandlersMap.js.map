{"version":3,"sources":["../../src/message-events-router/createEventHandlersMap.js"],"names":["actions","map","dm","Map","channel","group","forEach","eventHandler","where","handler","middlewares","events","eventName","has","Error","set"],"mappings":";;;;;;AACA;;;;;;kBASgBA,OAAD,IAA2D;AACxE,QAAMC,MAAM;AACVC,QAAI,IAAIC,GAAJ,EADM;AAEVC,aAAS,IAAID,GAAJ,EAFC;AAGVE,WAAO,IAAIF,GAAJ;AAHG,GAAZ;;AAMAH,UAAQM,OAAR,CAAiBC,YAAD,IAAoC;AAClD,QAAI,CAACA,aAAaC,KAAlB,EAAyBD,aAAaC,KAAb;AACzB,QAAI,CAACD,aAAaE,OAAlB,EAA2BF,aAAaE,OAAb,GAAuB,0BAAQF,aAAaG,WAArB,CAAvB;;AAE3BH,iBAAaC,KAAb,CAAmBF,OAAnB,CAA4BE,KAAD,IAAW;AACpCD,mBAAaI,MAAb,CAAoBL,OAApB,CAA6BM,SAAD,IAAuB;AACjD,YAAIX,IAAIO,KAAJ,EAAWK,GAAX,CAAeD,SAAf,CAAJ,EAA+B,MAAM,IAAIE,KAAJ,CAAW,qBAAoBF,SAAU,GAAzC,CAAN;AAC/BX,YAAIO,KAAJ,EAAWO,GAAX,CAAeH,SAAf,EAA0BL,YAA1B;AACD,OAHD;AAID,KALD;AAMD,GAVD;;AAYA,SAAON,GAAP;AACD,C","file":"createEventHandlersMap.js","sourcesContent":["/* @flow */\nimport compose from 'koa-compose';\nimport type { EventHandlerType } from './types';\n\ntype EventHandlerMapType = {\n  dm: Map<string, EventHandlerType>,\n  channel: Map<string, EventHandlerType>,\n  group: Map<string, EventHandlerType>,\n}\n\nexport default (actions: Array<EventHandlerType>): EventHandlerMapType => {\n  const map = {\n    dm: new Map(),\n    channel: new Map(),\n    group: new Map(),\n  };\n\n  actions.forEach((eventHandler: EventHandlerType) => {\n    if (!eventHandler.where) eventHandler.where = ['dm', 'channel', 'group'];\n    if (!eventHandler.handler) eventHandler.handler = compose(eventHandler.middlewares);\n\n    eventHandler.where.forEach((where) => {\n      eventHandler.events.forEach((eventName: string) => {\n        if (map[where].has(eventName)) throw new Error(`event redefined: \"${eventName}\"`);\n        map[where].set(eventName, eventHandler);\n      });\n    });\n  });\n\n  return map;\n};\n"]}