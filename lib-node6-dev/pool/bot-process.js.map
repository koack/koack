{"version":3,"sources":["../../src/pool/bot-process.js"],"names":["logger","id","Number","process","argv","initBot","require","teams","Map","on","message","error","type","team","Error","bot","set","teamId","has","warn","get","close"],"mappings":";;;;;;AAAA;;;;AACA;;AACA;;;;AACA;;;;AAEA,MAAMA,SAAS,gCAAW,YAAX,CAAf;;AAEA,MAAMC,aAAaC,OAAOC,QAAQC,IAAR,CAAa,CAAb,CAAP,CAAb,qCAAN;AACA;AACA,MAAMC,kBAAoBC,QAAQH,QAAQC,IAAR,CAAa,CAAb,CAAR,CAApB,4CAAN;;AAEA,MAAMG,gBAAuB,IAAIC,GAAJ,EAAvB,EAAOA,GAAP,UAAN;;AAEAL,QAAQM,EAAR,CAAW,SAAX,EAAsBC,WAAW;AAC/B,MAAI,OAAOA,OAAP,KAAmB,QAAvB,EAAiC;AAC/BV,WAAOW,KAAP,CAAa,oBAAb,EAAmCD,OAAnC;AACD;;AAED,UAAQA,QAAQE,IAAhB;AACE,SAAK,OAAL;AAAc;AACZ,cAAM,EAAEC,IAAF,aAA+BH,OAA/B;AAAYG,cAAZ;AAAA,uBAAN;AACA,YAAI,CAACA,KAAKZ,EAAV,EAAc,MAAM,IAAIa,KAAJ,CAAU,iBAAV,CAAN;;AAEd,cAAMC,MAAM,oBAAUF,IAAV,CAAZ;AACAN,cAAMS,GAAN,CAAUH,KAAKZ,EAAf,EAAmBc,GAAnB;AACAV,gBAAQU,GAAR;;AAEA;AACD;;AAED,SAAK,QAAL;AAAe;AACb,cAAM,EAAEE,MAAF,aAAiCP,OAAjC;AAAcO,gBAAd;AAAA,yBAAN;AACA,YAAI,CAACV,MAAMW,GAAN,CAAUD,MAAV,CAAL,EAAwB;AACtBjB,iBAAOmB,IAAP,CAAY,oBAAZ,EAAkC,EAAEF,MAAF,EAAlC;AACA;AACD;;AAED,cAAMF,cAAWR,MAAMa,GAAN,CAAUH,MAAV,CAAX,uBAAN;AACAF,YAAIM,KAAJ;AACA;AACD;;AAED;AAAS;AACPrB,eAAOmB,IAAP,CAAY,qBAAZ,EAAmCT,OAAnC;AACD;AA1BH;AA4BD,CAjCD","file":"bot-process.js","sourcesContent":["import Logger from 'nightingale-logger/src';\nimport { createBot } from '../bot';\nimport type Bot from '../bot/Bot';\nimport type { TeamType } from '../types';\n\nconst logger = new Logger('koack:pool');\n\nconst id: number = Number(process.argv[2]);\n// eslint-disable-next-line import/no-dynamic-require\nconst initBot: Function = require(process.argv[3]);\n\nconst teams: Map<any, Bot> = new Map();\n\nprocess.on('message', message => {\n  if (typeof message !== 'object') {\n    logger.error('Unexpected message', message);\n  }\n\n  switch (message.type) {\n    case 'start': {\n      const { team }: { team: TeamType } = message;\n      if (!team.id) throw new Error('Invalid team.id');\n\n      const bot = createBot(team);\n      teams.set(team.id, bot);\n      initBot(bot);\n\n      break;\n    }\n\n    case 'remove': {\n      const { teamId }: { teamId: string } = message;\n      if (!teams.has(teamId)) {\n        logger.warn('Unexpected team id', { teamId });\n        return;\n      }\n\n      const bot: Bot = teams.get(teamId);\n      bot.close();\n      break;\n    }\n\n    default: {\n      logger.warn('Unsupported message', message);\n    }\n  }\n});\n"]}