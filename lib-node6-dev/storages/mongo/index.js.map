{"version":3,"sources":["../../../src/storages/mongo/index.js"],"names":["mongoUrl","connection","connect","teams","collection","forEach","callback","find","installedTeam","installInfo","findOne","_id","team","id","insertOne"],"mappings":";;;;;;AAEA;;AACA;;AACA;;;;;;;;;AAHA;;;;;;;;;;+BAKe,WAAOA,QAAP,EAAkD;AAAA,wBAAnC,8BAAmC;;AAAA,iFAAhB,sCAAgB,EAAxB,qCAAQ,sCAAR,CAAwB;;AAAA;;AAC/D,UAAMC,aAAa,MAAM,qBAAYC,OAAZ,CAAoBF,QAApB,CAAzB;AACA,UAAMG,QAAQF,WAAWG,UAAX,CAAsB,OAAtB,CAAd;;AAEA,8BAAO;AACLC,eAAS,UAACC,QAAD;AAAA,eAAcH,MAAMI,IAAN,KAAeF,OAAf,CAAuBC,QAAvB,CAAd;AAAA,OADJ;;AAGLE;AAAA,sCAAe,WAAOC,WAAP,EAAwC;AAAA,iCAAtB,0CAAsB;;AAAA;;AACrD,0BAAQ,+BAAG,mCAAH,CAAR;AAAA,uCAAsB,MAAMN,MAAMO,OAAN,CAAc,EAAEC,KAAKF,YAAYG,IAAZ,CAAiBC,EAAxB,EAAd,CAA5B;;AAEA,cAAI,CAACD,IAAL,EAAW;AACTA;AACED,mBAAKF,YAAYG,IAAZ,CAAiBC;AADxB,eAEK,uBAAWJ,WAAX,CAFL;;AAKA,kBAAMN,MAAMW,SAAN,CAAgBF,IAAhB,CAAN;AACD,WAPD,MAOO;AACLA,oCAAO,uBAAWA,IAAX,EAAiBH,WAAjB,CAAP;AACD;;AAED,iBAAOG,IAAP;AACD,SAfD;;AAAA;AAAA;AAAA;AAAA;AAHK,KAAP;AAoBD,G","file":"index.js","sourcesContent":["/* @flow */\n// eslint-disable-next-line import/no-unresolved, import/extensions\nimport { MongoClient } from 'mongodb';\nimport type { InstallInfoType, StorageType, TeamType } from '../../types';\nimport { createTeam, updateTeam } from '../utils';\n\nexport default async (mongoUrl: string): Promise<StorageType> => {\n  const connection = await MongoClient.connect(mongoUrl);\n  const teams = connection.collection('teams');\n\n  return {\n    forEach: (callback) => teams.find({}).forEach(callback),\n\n    installedTeam: async (installInfo: InstallInfoType) => {\n      let team: ?TeamType = await teams.findOne({ _id: installInfo.team.id });\n\n      if (!team) {\n        team = {\n          _id: installInfo.team.id,\n          ...createTeam(installInfo),\n        };\n\n        await teams.insertOne(team);\n      } else {\n        team = updateTeam(team, installInfo);\n      }\n\n      return team;\n    },\n  };\n};\n"]}