{"version":3,"sources":["../../src/message-events-router/createEventHandlersMap.js"],"names":["EventHandlerMapType","dm","Map","channel","group","actions","map","forEach","eventHandler","where","handler","middlewares","events","eventName","has","Error","set"],"mappings":";;;;;;;;;;;AAAA;;;;AACA;;;;MAEKA,mB;AACHC,I,EAAIC,G;AACJC,S,EAASD,G;AACTE,O,EAAOF;;;kBAGM,gCAACG,OAAD,EAA2D;AAAA,UAA1DA,OAA0D;;AAAA;AACxE,UAAMC,MAAM;AACVL,UAAI,IAAIC,GAAJ,EADM;AAEVC,eAAS,IAAID,GAAJ,EAFC;AAGVE,aAAO,IAAIF,GAAJ;AAHG,KAAZ;;AAMAG,YAAQE,OAAR,CAAiBC,YAAD,IAAoC;AAAA,cAAnCA,YAAmC;;AAClD,UAAI,CAACA,aAAaC,KAAlB,EAAyBD,aAAaC,KAAb;AACzB,UAAI,CAACD,aAAaE,OAAlB,EAA2BF,aAAaE,OAAb,GAAuB,0BAAQF,aAAaG,WAArB,CAAvB;;AAE3BH,mBAAaC,KAAb,CAAmBF,OAAnB,CAA4BE,KAAD,IAAW;AACpCD,qBAAaI,MAAb,CAAoBL,OAApB,CAA6BM,SAAD,IAAuB;AAAA,kBAAtBA,SAAsB;;AACjD,cAAIP,IAAIG,KAAJ,EAAWK,GAAX,CAAeD,SAAf,CAAJ,EAA+B,MAAM,IAAIE,KAAJ,CAAW,sBAAoBF,SAAU,IAAzC,CAAN;AAC/BP,cAAIG,KAAJ,EAAWO,GAAX,CAAeH,SAAf,EAA0BL,YAA1B;AACD,SAHD;AAID,OALD;AAMD,KAVD;;AAYA,WAAOF,GAAP;AAnBwE,kCAAvBN,mBAAuB;AAoBzE,C","file":"createEventHandlersMap.js","sourcesContent":["import compose from 'koa-compose';\nimport type { EventHandlerType } from './types';\n\ntype EventHandlerMapType = {\n  dm: Map<EventHandlerType>,\n  channel: Map<EventHandlerType>,\n  group: Map<EventHandlerType>,\n}\n\nexport default (actions: Array<EventHandlerType>): EventHandlerMapType => {\n  const map = {\n    dm: new Map(),\n    channel: new Map(),\n    group: new Map(),\n  };\n\n  actions.forEach((eventHandler: EventHandlerType) => {\n    if (!eventHandler.where) eventHandler.where = ['dm', 'channel', 'group'];\n    if (!eventHandler.handler) eventHandler.handler = compose(eventHandler.middlewares);\n\n    eventHandler.where.forEach((where) => {\n      eventHandler.events.forEach((eventName: string) => {\n        if (map[where].has(eventName)) throw new Error(`event redefined: \"${eventName}\"`);\n        map[where].set(eventName, eventHandler);\n      });\n    });\n  });\n\n  return map;\n};\n"]}