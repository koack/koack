{"version":3,"sources":["../../src/server/index.js"],"names":["createTeam","installInfo","team","bot","installations","user","date","scopes","SlackServer","constructor","config","Object","assign","slackActions","client","slackClient","callbackUrl","successUrl","callback","pool","addTeam","installSuccess","use","get","authorize","ctx","body","listen","certificatesDirname"],"mappings":";;;;;;;AAKA;;;AALA;;;;AACA;;;;AACA;;;;AACA;;;;AAGA;;;;;;AAqBA,MAAMA,aAAcC,WAAD,iBACdA,YAAYC,IADE;AAEjBC,OAAKF,YAAYE,GAFA;AAGjBC,iBAAe,CACb,EAAEC,MAAMJ,YAAYI,IAApB,EAA0BC,MAAML,YAAYK,IAA5C,EAAkDC,QAAQN,YAAYM,MAAtE,EADa;AAHE,EAAnB;;AAQe,MAAMC,WAAN,uBAA8B;AAC3CC,cAAYC,MAAZ,EAA2C;AACzC;AACAC,WAAOC,MAAP,CAAc,IAAd,EAAoBF,MAApB;AACA;;AAEA,UAAMG,eAAe,qBAAmB;AACtCC,cAAQJ,OAAOK,WADuB;AAEtCR,cAAQG,OAAOH,MAFuB;AAGtCS,mBAAa,WAHyB;AAItCC,kBAAY,UAJ0B;AAKtCC,gBAAWjB,WAAD,IAAiB;AACzB,aAAKkB,IAAL,CAAUC,OAAV,CAAkBpB,WAAWC,WAAX,CAAlB;AACA,aAAKoB,cAAL,CAAoBpB,WAApB;AACD;AARqC,KAAnB,CAArB;;AAWA,SAAKqB,GAAL,CAAS,mBAAEC,GAAF,CAAM,GAAN,EAAWV,aAAaW,SAAxB,CAAT;AACA,SAAKF,GAAL,CAAS,mBAAEC,GAAF,CAAM,WAAN,EAAmBV,aAAaK,QAAhC,CAAT;AACA,SAAKI,GAAL,CAAS,mBAAEC,GAAF,CAAM,UAAN,EAAkBE,OAAOA,IAAIC,IAAJ,GAAW,YAApC,CAAT;AACD;;AAEDL,mBAAiB,CAChB;;AAEDM,SAAOjB,MAAP,EAAiCkB,mBAAjC,EAA+D;AAC7D,SAAKlB,MAAL,GAAc,0BAAWA,MAAX,CAAd;AACA,6BAAUkB,mBAAV,EAA+B,IAA/B;AACD;AA5B0C;kBAAxBpB,W","file":"index.js","sourcesContent":["import Koa from 'koa';\nimport _ from 'koa-route';\nimport alplisten from 'alp-listen';\nimport object2map from 'object2map';\nimport Pool from '../../src/pool';\n// import bodyParser from 'koa-bodyparser';\nimport createSlackActions from './slack';\nimport type { InstallInfoType, TeamType } from '../types/index';\n\ntype SlackClientConfigType = {|\n  clientID: string,\n  clientSecret: string,\n|};\n\ntype SlackServerConfigType = {|\n  slackClient: SlackClientConfigType,\n  pool: Pool,\n  scopes: Array<string>,\n|};\n\ntype ListenConfigType = {|\n  tls: ?boolean,\n  socketPath: ?string,\n  port: ?number,\n  hostname: ?string,\n|};\n\nconst createTeam = (installInfo: InstallInfoType): TeamType => ({\n  ...installInfo.team,\n  bot: installInfo.bot,\n  installations: [\n    { user: installInfo.user, date: installInfo.date, scopes: installInfo.scopes },\n  ],\n});\n\nexport default class SlackServer extends Koa {\n  constructor(config: SlackServerConfigType) {\n    super();\n    Object.assign(this, config);\n    // this.use(bodyParser());\n\n    const slackActions = createSlackActions({\n      client: config.slackClient,\n      scopes: config.scopes,\n      callbackUrl: '/callback',\n      successUrl: '/success',\n      callback: (installInfo) => {\n        this.pool.addTeam(createTeam(installInfo));\n        this.installSuccess(installInfo);\n      },\n    });\n\n    this.use(_.get('/', slackActions.authorize));\n    this.use(_.get('/callback', slackActions.callback));\n    this.use(_.get('/success', ctx => ctx.body = 'Youhou !!!'));\n  }\n\n  installSuccess() {\n  }\n\n  listen(config: ListenConfigType, certificatesDirname: ?string) {\n    this.config = object2map(config);\n    alplisten(certificatesDirname)(this);\n  }\n}\n"]}