{"version":3,"sources":["../../../src/storages/mongo/index.js"],"names":["mongoUrl","connection","connect","teams","collection","forEach","callback","find","installedTeam","installInfo","team","findOne","_id","id","insertOne"],"mappings":";;;;;;;;AAEA;;AAEA;;;AAHA;;;;+BAKe,WAAOA,QAAP,EAAkD;AAC/D,UAAMC,aAAa,MAAM,qBAAYC,OAAZ,CAAoBF,QAApB,CAAzB;AACA,UAAMG,QAAQF,WAAWG,UAAX,CAAsB,OAAtB,CAAd;;AAEA,WAAO;AACLC,eAAS,UAACC,QAAD;AAAA,eAAcH,MAAMI,IAAN,KAAeF,OAAf,CAAuBC,QAAvB,CAAd;AAAA,OADJ;;AAGLE;AAAA,sCAAe,WAAOC,WAAP,EAAwC;AACrD,cAAIC,OAAkB,MAAMP,MAAMQ,OAAN,CAAc,EAAEC,KAAKH,YAAYC,IAAZ,CAAiBG,EAAxB,EAAd,CAA5B;;AAEA,cAAI,CAACH,IAAL,EAAW;AACTA;AACEE,mBAAKH,YAAYC,IAAZ,CAAiBG;AADxB,eAEK,uBAAWJ,WAAX,CAFL;;AAKA,kBAAMN,MAAMW,SAAN,CAAgBJ,IAAhB,CAAN;AACD,WAPD,MAOO;AACLA,mBAAO,uBAAWA,IAAX,EAAiBD,WAAjB,CAAP;AACD;;AAED,iBAAOC,IAAP;AACD,SAfD;;AAAA;AAAA;AAAA;AAAA;AAHK,KAAP;AAoBD,G","file":"index.js","sourcesContent":["/* @flow */\n// eslint-disable-next-line import/no-unresolved, import/extensions\nimport { MongoClient } from 'mongodb';\nimport type { InstallInfoType, StorageType, TeamType } from '../../types';\nimport { createTeam, updateTeam } from '../utils';\n\nexport default async (mongoUrl: string): Promise<StorageType> => {\n  const connection = await MongoClient.connect(mongoUrl);\n  const teams = connection.collection('teams');\n\n  return {\n    forEach: (callback) => teams.find({}).forEach(callback),\n\n    installedTeam: async (installInfo: InstallInfoType) => {\n      let team: ?TeamType = await teams.findOne({ _id: installInfo.team.id });\n\n      if (!team) {\n        team = {\n          _id: installInfo.team.id,\n          ...createTeam(installInfo),\n        };\n\n        await teams.insertOne(team);\n      } else {\n        team = updateTeam(team, installInfo);\n      }\n\n      return team;\n    },\n  };\n};\n"]}