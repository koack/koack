{"version":3,"sources":["../../../src/storages/mongo/index.js"],"names":["mongoUrl","connection","connect","teams","collection","forEach","callback","find","installedTeam","installInfo","findOne","_id","team","id","insertOne"],"mappings":";;;;;;AAEA;;AACA;;AACA;;;;;;;;AAHA;;;;;;;kBAKe,qBAAOA,QAAP,EAAkD;AAAA,sBAAnC,8BAAmC;;AAAA,+EAAhB,sCAAgB,EAAxB,qCAAQ,sCAAR,CAAwB;;AAAA;;AAC/D,QAAMC,aAAa,MAAM,qBAAYC,OAAZ,CAAoBF,QAApB,CAAzB;AACA,QAAMG,QAAQF,WAAWG,UAAX,CAAsB,OAAtB,CAAd;;AAEA,4BAAO;AACLC,aAAUC,QAAD,IAAcH,MAAMI,IAAN,KAAeF,OAAf,CAAuBC,QAAvB,CADlB;;AAGLE,mBAAe,MAAOC,WAAP,IAAwC;AAAA,6BAAtB,0CAAsB;;AAAA;;AACrD,sBAAQ,+BAAG,mCAAH,CAAR;AAAA,mCAAsB,MAAMN,MAAMO,OAAN,CAAc,EAAEC,KAAKF,YAAYG,IAAZ,CAAiBC,EAAxB,EAAd,CAA5B;;AAEA,UAAI,CAACD,IAAL,EAAW;AACTA;AACED,eAAKF,YAAYG,IAAZ,CAAiBC;AADxB,WAEK,uBAAWJ,WAAX,CAFL;;AAKA,cAAMN,MAAMW,SAAN,CAAgBF,IAAhB,CAAN;AACD,OAPD,MAOO;AACLA,gCAAO,uBAAWA,IAAX,EAAiBH,WAAjB,CAAP;AACD;;AAED,aAAOG,IAAP;AACD;AAlBI,GAAP;AAoBD,C","file":"index.js","sourcesContent":["/* @flow */\n// eslint-disable-next-line import/no-unresolved, import/extensions\nimport { MongoClient } from 'mongodb';\nimport type { InstallInfoType, StorageType, TeamType } from '../../types';\nimport { createTeam, updateTeam } from '../utils';\n\nexport default async (mongoUrl: string): Promise<StorageType> => {\n  const connection = await MongoClient.connect(mongoUrl);\n  const teams = connection.collection('teams');\n\n  return {\n    forEach: (callback) => teams.find({}).forEach(callback),\n\n    installedTeam: async (installInfo: InstallInfoType) => {\n      let team: ?TeamType = await teams.findOne({ _id: installInfo.team.id });\n\n      if (!team) {\n        team = {\n          _id: installInfo.team.id,\n          ...createTeam(installInfo),\n        };\n\n        await teams.insertOne(team);\n      } else {\n        team = updateTeam(team, installInfo);\n      }\n\n      return team;\n    },\n  };\n};\n"]}