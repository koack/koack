{"version":3,"sources":["../../../src/storages/mongo/index.js"],"names":["MongoClient","InstallInfoType","StorageType","TeamType","createTeam","updateTeam","mongoUrl","connection","connect","teams","collection","forEach","callback","find","installedTeam","installInfo","findOne","_id","team","id","insertOne"],"mappings":";AACA;AACA,SAASA,WAAT,QAA4B,SAA5B;AACA,SAAcC,mCAAd,EAA+BC,2BAA/B,EAA4CC,qBAA5C,QAA4D,aAA5D;AACA,SAASC,UAAT,EAAqBC,UAArB,QAAuC,UAAvC;;;;;;AAEA,gBAAe,qBAAOC,QAAP,EAAkD;AAAA,sBAAnC,UAAmC;;AAAA,uCAAhB,kBAAgB,EAAxB,iBAAQ,kBAAR,CAAwB;;AAAA;;AAC/D,QAAMC,aAAa,MAAMP,YAAYQ,OAAZ,CAAoBF,QAApB,CAAzB;AACA,QAAMG,QAAQF,WAAWG,UAAX,CAAsB,OAAtB,CAAd;;AAEA,4BAAO;AACLC,aAAUC,QAAD,IAAcH,MAAMI,IAAN,KAAeF,OAAf,CAAuBC,QAAvB,CADlB;;AAGLE,mBAAe,MAAOC,WAAP,IAAwC;AAAA,6BAAtB,sBAAsB;;AAAA;;AACrD,sBAAQ,WAAG,eAAH,CAAR;AAAA,mCAAsB,MAAMN,MAAMO,OAAN,CAAc,EAAEC,KAAKF,YAAYG,IAAZ,CAAiBC,EAAxB,EAAd,CAA5B;;AAEA,UAAI,CAACD,IAAL,EAAW;AACTA;AACED,eAAKF,YAAYG,IAAZ,CAAiBC;AADxB,WAEKf,WAAWW,WAAX,CAFL;;AAKA,cAAMN,MAAMW,SAAN,CAAgBF,IAAhB,CAAN;AACD,OAPD,MAOO;AACLA,gCAAOb,WAAWa,IAAX,EAAiBH,WAAjB,CAAP;AACD;;AAED,aAAOG,IAAP;AACD;AAlBI,GAAP;AAoBD,CAxBD","file":"index.js","sourcesContent":["/* @flow */\n// eslint-disable-next-line import/no-unresolved, import/extensions\nimport { MongoClient } from 'mongodb';\nimport type { InstallInfoType, StorageType, TeamType } from '../../types';\nimport { createTeam, updateTeam } from '../utils';\n\nexport default async (mongoUrl: string): Promise<StorageType> => {\n  const connection = await MongoClient.connect(mongoUrl);\n  const teams = connection.collection('teams');\n\n  return {\n    forEach: (callback) => teams.find({}).forEach(callback),\n\n    installedTeam: async (installInfo: InstallInfoType) => {\n      let team: ?TeamType = await teams.findOne({ _id: installInfo.team.id });\n\n      if (!team) {\n        team = {\n          _id: installInfo.team.id,\n          ...createTeam(installInfo),\n        };\n\n        await teams.insertOne(team);\n      } else {\n        team = updateTeam(team, installInfo);\n      }\n\n      return team;\n    },\n  };\n};\n"]}